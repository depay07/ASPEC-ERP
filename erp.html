<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ASPEC ERP System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; font-size: 13px; background-color: #f1f5f9; }
        
        /* 모달 */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 50; display: none; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 95%; max-width: 1200px; max-height: 90vh; overflow-y: auto; border-radius: 8px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .modal.active { display: flex; }

        /* 테이블 */
        .data-table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        .data-table th { background-color: #e2e8f0; color: #475569; font-weight: 700; padding: 12px 8px; border-bottom: 2px solid #cbd5e1; text-align: center; font-size: 14px; }
        .data-table td { padding: 12px 8px; border-bottom: 1px solid #e2e8f0; color: #334155; vertical-align: middle; font-size: 14px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-align: center; }
        
        .input-box { width: 100%; padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 4px; transition: all 0.2s; font-size: 14px; }
        .input-box:focus { outline: none; border-color: #06b6d4; ring: 2px solid #e0f2fe; }
        .search-panel { background-color: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .search-label { font-size: 12px; font-weight: bold; color: #64748b; margin-bottom: 6px; display: block; text-transform: uppercase; }
        
        /* 대시보드 애니메이션 */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 1s ease-out forwards; }

        /* 캘린더 스타일 */
        .calendar-container { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid #e2e8f0; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); }
        .calendar-day-header { background: #f8fafc; border: 1px solid #e2e8f0; padding: 10px; text-align: center; font-weight: 600; color: #64748b; font-size: 12px; }
        .calendar-day { border: 1px solid #e2e8f0; min-height: 120px; padding: 4px; background: white; cursor: pointer; transition: background 0.2s; position: relative; overflow: hidden; }
        .calendar-day:hover { background: #f8fafc; }
        .calendar-day.other-month { background: #f1f5f9; color: #94a3b8; }
        .calendar-day.today { background: #eff6ff; border: 2px solid #3b82f6; }
        .calendar-day-number { font-size: 14px; font-weight: 600; margin-bottom: 4px; color: #1e293b; }
        .calendar-day.other-month .calendar-day-number { color: #94a3b8; }
        .calendar-day.today .calendar-day-number { color: #2563eb; font-weight: 700; }
        .calendar-event { font-size: 11px; padding: 2px 6px; margin: 2px 0; border-radius: 3px; cursor: pointer; transition: opacity 0.2s; word-wrap: break-word; white-space: normal; line-height: 1.3; }
        .calendar-event:hover { opacity: 0.8; }
        .calendar-event.allday { font-weight: 600; }
        .calendar-more-events { font-size: 11px; color: #64748b; cursor: pointer; padding: 2px 6px; margin: 2px 0; text-align: center; font-weight: 600; }
        .calendar-more-events:hover { background: #f1f5f9; border-radius: 3px; }

        .calendar-day-header:nth-child(7n+1) { color: #ef4444 !important; }
        .calendar-day-header:nth-child(7n) { color: #3b82f6 !important; }
        .calendar-day:nth-child(7n+1):not(.other-month) .calendar-day-number { color: #ef4444 !important; }
        .calendar-day:nth-child(7n):not(.other-month) .calendar-day-number { color: #3b82f6 !important; }

        /* 이벤트 색상 */
        .event-red { background-color: #fee2e2; color: #991b1b; }
        .event-orange { background-color: #fed7aa; color: #9a3412; }
        .event-yellow { background-color: #fef08a; color: #854d0e; }
        .event-green { background-color: #bbf7d0; color: #166534; }
        .event-blue { background-color: #bfdbfe; color: #1e40af; }
        .event-indigo { background-color: #c7d2fe; color: #3730a3; }
        .event-purple { background-color: #e9d5ff; color: #6b21a8; }
        .event-pink { background-color: #fbcfe8; color: #9f1239; }
        
        .color-selector { display: flex; gap: 8px; margin-top: 8px; }
        .color-option { width: 30px; height: 30px; border-radius: 4px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s; }
        .color-option:hover { transform: scale(1.1); }
        .color-option.selected { border-color: #1e293b; box-shadow: 0 0 0 2px white, 0 0 0 4px #1e293b; }

        /* 인쇄 전용 스타일 */
        @media print {
            @page { size: A4; margin: 0; }
            body { margin: 0; padding: 0; background: white; }
            body * { visibility: hidden; }
            
            #printContainer, #printContainer * { visibility: visible; box-sizing: border-box; }
            #printContainer { position: absolute; left: 0; top: 0; width: 100%; font-family: "Malgun Gothic", dotum, sans-serif; color: black !important; }
            
            .print-wrap { width: 100%; padding: 15mm; margin: 0 auto; }
            .print-title-area { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; border-bottom: 2px solid black; padding-bottom: 5px; }
            .print-title-main { font-size: 36px; font-weight: 900; letter-spacing: -1px; }
            .print-title-sub { font-size: 16px; font-weight: normal; font-style: italic; margin-left: 10px; }
            .print-meta { text-align: right; font-size: 11px; line-height: 1.4; }
        
            .print-grid-box { display: flex; width: 100%; border: 1px solid black; margin-bottom: 10px; }
            .print-half { width: 50%; padding: 0; flex: 1; }
            .print-half:first-child { border-right: 1px solid black; }
        
            .print-info-table { width: 100%; border-collapse: collapse; font-size: 11px; table-layout: fixed; border: none; }
            .print-info-table th { background-color: #f3f3f3 !important; text-align: center; padding: 5px; border-bottom: 1px solid black; border-right: 1px solid black; width: 20%; font-weight: bold; height: 30px; -webkit-print-color-adjust: exact; }
            .print-info-table td { padding: 2px 5px; border-bottom: 1px solid black; height: 30px; vertical-align: middle; font-size: 11px; word-break: break-all; overflow: hidden; }
            .print-info-table tr:last-child th, .print-info-table tr:last-child td { border-bottom: none; }
            .print-header-cell { text-align: center; font-weight: bold; padding: 5px; border-bottom: 1px solid black; font-size: 14px; background-color: #e6e6e6 !important; -webkit-print-color-adjust: exact; }
        
            .print-items-table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 11px; table-layout: fixed; }
            .print-items-table th { border: 1px solid black; background-color: #f3f3f3 !important; padding: 5px; text-align: center; -webkit-print-color-adjust: exact; }
            .print-items-table td { border: 1px solid black; padding: 5px; height: 35px; word-break: keep-all; white-space: normal; vertical-align: middle; }
            
            .addr-cell { height: 55px !important; vertical-align: top !important; padding-top: 5px !important; line-height: 1.4; }
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div class="flex h-screen overflow-hidden no-print">
        <aside class="w-52 bg-slate-900 text-slate-300 flex flex-col shadow-xl z-20">
            <div class="p-6 border-b border-slate-800">
                <a href="erp.html" class="block cursor-pointer hover:opacity-80 transition"><h1 class="text-2xl font-bold text-white">ASPEC <span class="text-cyan-400 text-sm">ERP</span></h1></a>
            </div>
            
            <nav class="flex-1 py-4 overflow-y-auto text-base">
                <button onclick="switchTab('dashboard')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3 bg-slate-800 text-white font-bold"><i class="fa-solid fa-house w-5"></i> 홈 화면</button>
                <button onclick="switchTab('calendar')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-calendar-days w-5"></i> 일정 관리</button>
                
                <button onclick="switchTab('bookkeeping')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3 text-orange-400 font-semibold"><i class="fa-solid fa-book-open w-5"></i> 기장 관리</button>

                <div class="px-6 text-xs font-bold text-slate-500 uppercase mt-4 mb-2">영업 관리</div>
                <button onclick="switchTab('quotes')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-file-invoice w-5"></i> 견적 관리</button>
                <button onclick="switchTab('orders')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-file-signature w-5"></i> 주문 관리</button>
                <button onclick="switchTab('sales')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-truck-fast w-5"></i> 판매 관리</button>
                <button onclick="switchTab('collections')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-sack-dollar w-5"></i> 수금 관리</button>

                <div class="px-6 text-xs font-bold text-slate-500 uppercase mt-6 mb-2">자재/발주</div>
                <button onclick="switchTab('purchase_orders')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-file-import w-5"></i> 발주 관리 (PO)</button>
                <button onclick="switchTab('purchases')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-dolly w-5"></i> 구매 관리 (입고)</button>
                <button onclick="switchTab('inventory')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-warehouse w-5"></i> 재고 관리 현황</button>
                
                <div class="px-6 text-xs font-bold text-slate-500 uppercase mt-6 mb-2">기초 등록</div>
                <button onclick="switchTab('partners')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-building w-5"></i> 거래처 관리</button>
                <button onclick="switchTab('products')" class="nav-btn w-full text-left px-6 py-3 hover:bg-slate-800 hover:text-white flex items-center gap-3"><i class="fa-solid fa-box w-5"></i> 품목 관리</button>
            </nav>
            <div class="p-6 border-t border-slate-800"><button onclick="logout()" class="w-full bg-slate-800 py-3 rounded text-sm hover:text-white font-bold">로그아웃</button></div>
        </aside>
        <main class="flex-1 overflow-y-auto p-8" id="mainContent">
            <div id="searchContainer"></div>
            <div id="contentArea"></div>
        </main>
    </div>

    <div id="genericModal" class="modal no-print"><div class="modal-content"><div class="flex justify-between items-center mb-6 border-b pb-4"><h2 id="modalTitle" class="text-2xl font-bold text-slate-800">입력</h2><button onclick="closeModal()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-times text-2xl"></i></button></div><div id="modalBody"></div></div></div>
    
    <div id="loadDataModal" class="modal no-print" style="z-index: 60;"><div class="modal-content" style="max-width: 800px;"><h3 class="text-xl font-bold mb-4" id="loadModalTitle">데이터 불러오기</h3><div class="overflow-y-auto max-h-96 border rounded"><table class="w-full text-left text-sm"><thead class="bg-slate-50"><tr><th class="p-3">날짜</th><th class="p-3">거래처</th><th class="p-3">총액</th><th class="p-3">선택</th></tr></thead><tbody id="loadDataBody"></tbody></table></div><div class="mt-6 text-right"><button onclick="document.getElementById('loadDataModal').classList.remove('active')" class="px-6 py-2 bg-slate-200 rounded text-sm font-bold">닫기</button></div></div></div>

    <div id="eventModal" class="modal no-print">
        <div class="modal-content" style="max-width: 600px;">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 id="eventModalTitle" class="text-2xl font-bold text-slate-800">일정 추가</h2>
                <button onclick="closeEventModal()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-times text-2xl"></i></button>
            </div>
            <div id="eventModalBody">
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">일정 제목</label>
                    <input type="text" id="eventTitle" class="input-box" placeholder="일정 제목을 입력하세요">
                </div>
                <div class="mb-4">
                    <label class="flex items-center gap-2 text-sm font-semibold text-slate-700 mb-2">
                        <input type="checkbox" id="eventAllDay" onchange="toggleAllDay()">
                        <span>하루 종일</span>
                    </label>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">시작</label>
                        <input type="date" id="eventStartDate" class="input-box mb-2">
                        <input type="time" id="eventStartTime" class="input-box">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-slate-700 mb-2">종료</label>
                        <input type="date" id="eventEndDate" class="input-box mb-2">
                        <input type="time" id="eventEndTime" class="input-box">
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">메모</label>
                    <textarea id="eventDescription" class="input-box" rows="3" placeholder="메모를 입력하세요"></textarea>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-2">색상 라벨</label>
                    <div class="color-selector">
                        <div class="color-option event-red" data-color="red" onclick="selectColor('red')"></div>
                        <div class="color-option event-orange" data-color="orange" onclick="selectColor('orange')"></div>
                        <div class="color-option event-yellow" data-color="yellow" onclick="selectColor('yellow')"></div>
                        <div class="color-option event-green selected" data-color="green" onclick="selectColor('green')"></div>
                        <div class="color-option event-blue" data-color="blue" onclick="selectColor('blue')"></div>
                        <div class="color-option event-indigo" data-color="indigo" onclick="selectColor('indigo')"></div>
                        <div class="color-option event-purple" data-color="purple" onclick="selectColor('purple')"></div>
                        <div class="color-option event-pink" data-color="pink" onclick="selectColor('pink')"></div>
                    </div>
                </div>
                <div class="flex justify-between">
                    <button id="deleteEventBtn" onclick="deleteEvent()" class="px-6 py-3 bg-red-500 text-white rounded font-bold hover:bg-red-600" style="display: none;">삭제</button>
                    <div class="flex-1"></div>
                    <button onclick="closeEventModal()" class="px-6 py-3 bg-slate-200 rounded font-bold hover:bg-slate-300 mr-2">취소</button>
                    <button onclick="saveEvent()" class="px-6 py-3 bg-blue-500 text-white rounded font-bold hover:bg-blue-600">저장</button>
                </div>
            </div>
        </div>
    </div>

    <div id="allEventsModal" class="modal no-print">
        <div class="modal-content" style="max-width: 500px;">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 id="allEventsModalTitle" class="text-2xl font-bold text-slate-800">일정 목록</h2>
                <button onclick="closeAllEventsModal()" class="text-slate-400 hover:text-red-500"><i class="fa-solid fa-times text-2xl"></i></button>
            </div>
            <div id="allEventsModalBody" class="max-h-96 overflow-y-auto"></div>
            <div class="mt-6 text-right">
                <button onclick="closeAllEventsModal()" class="px-6 py-3 bg-slate-200 rounded font-bold hover:bg-slate-300">닫기</button>
            </div>
        </div>
    </div>

    <div id="printContainer" class="hidden">
        <div class="print-wrap">
            <div class="print-title-area">
                <div><span id="p_title_ko" class="print-title-main">견 적 서</span><span id="p_title_en" class="print-title-sub">QUOTATION</span></div>
                <div class="print-meta"><div>문서번호: <span id="p_no"></span></div><div>작성일자: <span id="p_date"></span></div></div>
            </div>
            <div class="print-grid-box">
                <div class="print-half">
                    <div class="print-header-cell" id="p_left_role">공 급 받 는 자</div>
                    <table class="print-info-table">
                        <colgroup><col style="width: 20%;"><col style="width: 80%;"></colgroup>
                        <tr><th>상호</th><td id="p_left_name"></td></tr>
                        <tr id="print_row_addr_1"><th>주소</th><td id="p_left_addr" class="addr-cell"></td></tr>
                        <tr><th>담당자</th><td id="p_left_manager"></td></tr>
                        <tr><th>TEL</th><td id="p_left_phone"></td></tr>
                        <tr><th>E-mail</th><td id="p_left_email"></td></tr>
                    </table>
                </div>
                <div class="print-half">
                    <div class="print-header-cell" id="p_right_role">공 급 자</div>
                    <table class="print-info-table">
                        <colgroup><col style="width: 20%;"><col style="width: 80%;"></colgroup>
                        <tr><th>상호</th><td id="p_right_name">아스펙 (ASPEC)</td></tr>
                        <tr id="print_row_addr_2"><th>주소</th><td class="addr-cell" style="font-size: 10px;">경기도 화성시 메타폴리스로 42, 9층 902호<br>(반송동, 디앤씨빌딩)</td></tr>                   
                        <tr><th>담당자</th><td id="p_right_manager"></td></tr>
                        <tr><th>TEL</th><td id="p_right_mp"></td></tr>
                        <tr><th>E-mail</th><td id="p_right_email"></td></tr>
                    </table>
                </div>
            </div>
            <table class="print-items-table">
                <colgroup><col style="width: 5%;"><col style="width: 25%;"><col style="width: 30%;"><col style="width: 8%;"><col style="width: 8%;"><col style="width: 12%;"><col style="width: 12%;"></colgroup>
                <thead><tr><th>No</th><th>품명</th><th>규격</th><th>단위</th><th>수량</th><th>단가</th><th>공급가액</th></tr></thead>
                <tbody id="p_tbody"></tbody>
                <tfoot>
                    <tr style="background: #f8f8f8; font-weight: bold;"><td colspan="4" style="text-align: center; border-right: 1px solid black;">합 계 (Total)</td><td style="text-align: center; border-right: 1px solid black;" id="p_total_qty"></td><td style="text-align: right; border-right: 1px solid black;">공급가액</td><td style="text-align: right;" id="p_sum_supply"></td></tr>
                    <tr><td colspan="5" style="border-right: 1px solid black; border-bottom: 1px solid black;"></td><td style="text-align: right; border-right: 1px solid black; background: #f8f8f8;">부가세 (VAT)</td><td style="text-align: right;" id="p_sum_vat"></td></tr>
                    <tr style="font-weight: bold;"><td colspan="5" style="border-right: 1px solid black; border-bottom: 1px solid black;"></td><td style="text-align: right; border-right: 1px solid black; background: #e6e6e6;">총 합계</td><td style="text-align: right; background: #e6e6e6;" id="p_total_amt"></td></tr>
                    <tr style="background: #fff; border-top: 2px double black;"><td colspan="7" style="padding: 10px; text-align: left;"><strong>[비고]</strong> <span id="p_note"></span></td></tr>
                </tfoot>
            </table>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://gqttpmdpqotrkbdbstuu.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdxdHRwbWRwcW90cmtiZGJzdHV1Iiwicm9sZSI6ImdxdHRwbWRwcW90cmtiZGJzdHV1Iiwicm9sZSI6ImFub24iLCJpYX
